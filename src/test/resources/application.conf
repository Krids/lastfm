# Test configuration - overrides for unit tests
# NOTE: We copy the main configuration here instead of including it
# to avoid circular dependency issues

# Environment configuration
environment = "test"

# Spark configuration
spark {
  app.name = "LastFM-Session-Analyzer"
  master = "local[2]"
  
  # Performance settings
  sql.adaptive.enabled = true
  sql.adaptive.skewJoin.enabled = true
  sql.adaptive.coalescePartitions.enabled = true
  serializer = "org.apache.spark.serializer.KryoSerializer"
  
  # Memory settings
  driver.memory = "2g"
  executor.memory = "1g"
  
  # Partitioning
  partitions.default = 8
  partitions.ranking = 4
  partitions.output = 1
}

# Data paths configuration
data {
  # Input paths
  input {
    base = "data/input"
    dataset = ${data.input.base}"/lastfm-dataset-1k"
    profile = ${data.input.dataset}"/userid-profile.tsv"
    events = ${data.input.dataset}"/userid-timestamp-artid-artname-traid-traname.tsv"
  }
  
  # Output paths
  output {
    base = "data/output"
    bronze = ${data.output.base}"/bronze"
    silver = ${data.output.base}"/silver"
    gold = ${data.output.base}"/gold"
    results = ${data.output.base}"/results"
  }
}

# Pipeline configuration
pipeline {
  # Session analysis settings
  session {
    gap.minutes = 20
  }
  
  # Ranking settings
  ranking {
    top.sessions = 50
    top.tracks = 10
  }
  
  # Quality thresholds
  quality {
    acceptable.threshold = 95.0
    max.rejection.rate = 0.05
  }
  
  # Retry configuration
  retry {
    max.attempts = 3
    delay.ms = 1000
    backoff.multiplier = 2.0
  }
  
  # Cache configuration
  cache {
    enabled = true
    storage.level = "MEMORY_AND_DISK_SER"
  }
}

# Monitoring configuration
monitoring {
  metrics {
    enabled = true
    interval.seconds = 60
  }
  
  # Performance thresholds
  performance {
    warning.threshold.ms = 5000
    error.threshold.ms = 30000
  }
}

# Logging configuration
logging {
  level {
    root = "WARN"
    spark = "WARN"
    application = "INFO"
  }
}
